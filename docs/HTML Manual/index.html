<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<title>PIA-Tunnel Documentation</title>
<meta name="author" content="Mirko Kaiser">
<meta name="keywords" content="">
<meta name="description" content="Official documentation for the PIA-Tunnel VM">
<meta name="robots" content="NOINDEX,NOFOLLOW">
<meta name="dcterms.creator" content="Mirko Kaiser">
<link rel="stylesheet" type="text/css" href="manual.css">
</head>
<body>

<h1>PIA-Tunnel Documentation</h1>

<p>
  This documentation is work in progress. Some sections may not have been verified yet or are still
  being tested.
</p>

<div id="main_index" class="section">
  <h2>Index</h2>
  <ul>
  <li><a href="#overview">Overview</a></li>

  <li><a href="#vm_setup">Virtual Machine Setup</a></li>

  <li><a href="#pi_setup">Raspberry Pi / stand alone setup</a></li>

  <li><a href="#start_vm">Starting PIA-Tunnel for the first time</a></li>

  <li><a href="#wizard">PIA-Tunnel Setup Wizard</a></li>

  <li><a href="#socks5_setup">SOCKS5 Proxy Server Setup</a></li>

  <li>
    <a href="#defaultgw_setup">Default Gateway Setup</a>
    <ul>
      <li><a href="#defaultgw_single">Basic - One Network Interface</a></li>
      <li><a href="#defaultgw_dual">Advanced - Dual Network Interface</a></li>
    </ul>

    <a href="#defaultgw_bindnic">Single PC with Default Gateway Setup</a>
  </li>

  <li><a href="#webUI">PIA-Tunnel webUI (Management Interface)</a>
    <ul>
      <li>Tools</li>

      <li><a href="#s_general">Settings</a></li>
    </ul>
  </li>





  <li><a href="#client_setup_overview">Configure Client PC/Devices for your VPN connection</a></li>

  <li><a href="#transmission_setup">Setup transmission daemon (torrent client) on the VM</a></li>

  <li>Running a Server or Torrent Client</li>

  <li>Starting your Torrent client with monitor.vbs</li>

  <li><strong>! HELP !</strong>
    <ul>
      <li><a href="#h_firewall">Connection issues with new VMs</a></li>
    </ul>
  </li>

  <li>Known Issues</li>

  <li>Credits</li>

  </ul>
</div>


<div id="overview" class="section">
  <h2>Overview</h2> <a href="#main_index">Back To Top</a>
  <p>
    PIA-Tunnel is a series of scripts designed to share an openVPN connection with your network.
    It supports port forwarding, failover locations, LAN segments and a SOCKS5 proxy.
    The included web interface makes it easy to setup connections and get the system configured to
    your network.<br>
    The included shell scripts make it possible to control the system from the command line as well.
  </p>
  <p>
    PIA-Tunnel started out as a virtual machine for VMware Workstation, Player and ESXi but
    is now being used on KVM, XEN, Hyper-V and other solutions.<br>
    PIA-Tunnel is currently being tested on a Raspberry Pi 1 Model B+, with promising results.
    The combination turns PIA-Tunnel into a stand alone VPN router for your network.
    Advanced setups may utilize two network adapters to completely isolate a network or system.
  </p>

  <h3>Features</h3>
  <ul>
    <li>Open by design! PIA-Tunnel is script based and you may roll your own installation
        by following the steps in 'Clean Installation Steps.txt'
    </li>
    <li>Complete network isolation with VM LAN segment (leak protection)</li>
    <li>Simple Web-interface and/or command line support</li>
    <li>SOCKS 5 proxy for LAN or VM LAN segment. proxifier.com compatible</li>
    <li>Port forwarding to 1 IP on your LAN or private VM LAN</li>
    <li>Runs on existing hardware, your Computer, Laptop or Homeserver</li>
    <li>Requires 1 CPU core, 256MB RAM and less then 2GB free drive space</li>
    <li>Supports PrivateInternetAccess.com and FrootVPN.com out of the box</li>
  </ul>

    <a href="./grfx/overview.png"><img src="./grfx/overview-small.png" alt="webUI screenshot"></a>
</div>


<div id="vm_setup" class="section">
  <h2>Virtual Machine Setup</h2> <a href="#main_index">Back To Top</a>
  <ol>
    <li>Download the compressed OVF Template from <a href="http://www.kaisersoft.net/r/?PIAIMG" target="_blank">http://www.kaisersoft.net/r/?PIAIMG</a></li>
    <li>Extract the 7-Zip archive. 7-Zip is a free compression utility <a href="http://www.7-zip.org/" target="_blank">http://www.7-zip.org</a></li>
  </ol>

  <h3>VMware Workstation and Player</h3>
  <ol>
    <li>Add the OVF Template to VMware Workstation or Player by double clicking on "PIA-Tunnel.ovf" then on "Import".</li>
    <li>Ensure that the second network adapter is a member of a private LAN segment
      <ol>
        <li>Select "Network Adapter 2"</li>
        <li>Click "LAN Segments" => "Add"</li>
        <li>Enter name of LAN segment. For example: "VPN Bridge"</li>
        <li>Click OK to close</li>
        <li>Use Dropdown to select the LAN segment you just created and click OK</li>
      </ol>
      <br>
      Note:  Connect client VMs to this LAN segment and remove or disable their other network cards for complete isolation.
    </li>
  </ol>

  <h3>ESXi</h3>
  <ol>
  <li>Setup private VM LAN segment first using vSphere Client
    <ol>
      <li>select your ESXi server and choose "Configuration"</li>
      <li>Click on "Networking" => "Add Networking..."</li>
      <li>"Virtual Machine" => "Create a vSphere standard switch" uncheck any selected interfaces!<br>
          NOTE: The preview must list "No adapters" on the "Physical Adapters" side!</li>
      <li>Enter a network name. For example VPN Network - PIA</li>
    </ol>
  </li>

  <li>Import the OVF Image
    <ol>
      <li>Extract the file you downloaded. You should now have a folder with tree files</li>
      <li>"File" => "Deploy OVF Template..."</li>
      <li> Browse to the extracted files and select "PIA-Tunnel.ovf" => "Next" => "Next"</li>
      <li>Give the VM a name and select a datastore to keep the machine on => "Next"</li>
      <li>Use "Thin Provision" since the VM will not change much</li>
      <li>Select your external Network on the "Network Mapping" screen</li>
      <li>Do not auto power the machine once deployment is complete</li>
    </ol>
  </li>

  <li>Configure the VM
    <ol>
      <li>Select the VM => "Edit Settings"</li>
      <li>Make sure that "Network adapter 1" is connected to the network with Internet access and that "Network adapter 2" is connected to the private LAN segment you created in step 1 above.</li>
      <li>RAM should be set to at least 256MB RAM. You may set it to as little as 92MB if you don't intend to run the SOCKS proxy server.</li>
    </ol>
  </li>
  </ol>

  <p>
    <strong>WARNING:</strong> Do not connect both interfaces to the same network. It will create
    routing conflicts and the VPN will fail to connect.<br>
    Remove the second network card if you don't intend use network isolation. You may always add
    the interface later.
  </p>
</div>



<div id="start_vm" class="section">
  <h2>Power on / starting PIA Tunnel VM</h2> <a href="#main_index">Back To Top</a>
  <p>
    <strong>WARNING:</strong> Do not connect both interfaces to the same network. It will create
    routing conflicts and the VPN will fail to connect.<br>
    Remove the second network card if you don't intend use network isolation. You may always add
    the interface later.
  </p>

  <ol>
    <li>Verify that the machine has one CPU and at least 256MB of RAM.</li>
    <li>Start the VM and wait until you see Public LAN IP<br>
      <a href="./grfx/fresh_boot.png"><img src="./grfx/fresh_boot_small.png"></a></li>
    <li>Open the Public LAN IP in your web browser</li>
    <li>The PIA-Tunnel Management Interface should open and prompt you to reset your system.<br>
        This step is NOT OPTIONAL so click on Prepare the System and Reboot to continue.</li>
    <li>Wait until you see pia-tunnel login: again, then refresh the page.</li>
    <li>The PIA-Tunnel Setup Wizard will now open.<br>
      <a href="./grfx/static_ip_wizard.png"><img src="./grfx/static_ip_wizard-small.png"></a>
    </li>
  </ol>
</div>


<div id="wizard" class="section">
	<h2>Setup Wizard</h2> <a href="#main_index">Back To Top</a>

	<p>The PIA-Tunnel Setup Wizard will be executed every time the VM is reset. It ensures that the basic configuration options are set properly.</p>

	<ul>
      <li>Web-UI Username and Web-UI Password<br>
          Access to the Web-UI will be restricted to this user.</li>

      <li>VPN Username and VPN Password<br>
          Please enter your PIA username and password into these fields</li>

      <li>VPN Gateway for public LAN<br>
      Set this option to yes if you want to share the VPN connection with other computers on your network.</li>

      <li>VPN Gateway for VM LAN<br>
      Set this option to yes if you want to share the VPN connection with a private VM LAN segment</li>

      <li>root password<br>
      <li>This option will change the default root password from pia to something sane. You may enter your own password or accept the randomly generated one.</li>
	</ul>

	NOTE: The web GUI is supposed to replace any command line interaction so I recommend that you accept the generated password. You may reset the root password later via the Tools menu.
</div>


<div id="webUI" class="section">
	<h2>PIA-Tunnel WebUI - Management Interface</h2> <a href="#main_index">Back To Top</a>

	<p>
		The WebUI should work with any basic HTML5 browser, even with javascript disabled.  Enabling javascript will activate the advanced UI which will reconfigure some UI elements, enable automatic Network Status updates and make the Settings page easier to use.
	</p>


	<div id="s_general" class="sub_section">
	<h3>Settings - General Settings</h3> <a href="#main_index">Back To Top</a>
    <p>
      These are the important settings for PIA-Tunnel. Please take a moment to understand what they do.
    </p>

	<ul>
      <li>
        <strong>VPN Gateway for VM LAN</strong>:  &lt;yes/no;&gt; (default: yes)<br>
        Setting this option to yes will share the VPN connection with any computer on your private VM LAN Segment. The LAN segment is called VPN Bridge in the setup portion of this guide.
      </li>

      <li>
        <strong>VPN Gateway for public LAN</strong>:  &lt;yes/no&gt; (default: yes)<br>
        Setting this option to yes will share the VPN connection with any computer on your public  LAN Segment. This is your home network, so any computer that may use your current Internet connection will be able to use PIA-Tunnel to access the VPN.
      </li>

      <li>
        <strong>Allow web-UI access on</strong>: &lt;eth0&gt; &lt;eth1&gt; (default: both checked)<br>
        This option will open port 80 on the selected interfaces. This is needs to be enabled if you want to use the web-UI to mange PIA-Tunnel and if you want to use Torrent Monitor client.<br>
        <strong>Warning</strong>: Unchecking both options will prevent you from accessing the web-UI. You may regain access by adding   FIREWALL_IF_WEB[0]=eth0    back into /usr/local/pia/settings.conf
      </li>

      <li>
        <strong>Allow ssh connections on</strong>: &lt;eth0&gt; &lt;eth1&gt; (default: both NOT checked)<br>
        Same as Allow web-UI access but for port 22, remote SSH access. Dont enable this if you dont know what SSH is or if you dont indent to use it.
      </li>

      <li>
        <strong>Web-UI Username and Web-UI Password</strong><br>
        This option specifies the username and password for the Web-UI. Note: You may reset the password by setting the following options to nothing in /usr/local/pia/settings.conf<br>
        WEB_UI_USER=<br>
        WEB_UI_PASSWORD=<br>
      </li>

      <li>
        <strong>Remember Me for</strong>: &lt;some integer&gt; (default: 120) days<br>
        No login required for this many days. Set to 0 (zero) to disable this feature.
      </li>
	</ul>
	</div>


	<div id="s_daemon" class="sub_section">
	<h3>Settings - PIA Daemon Settings</h3> <a href="#main_index">Back To Top</a>
	<p>
      PIA Daemon is a script that may be used to keep your network connected to the VPN.<br>
      It will test the VPN connection every few minutes, stop all VPN forwarding on error and attempt to reconnect when the connection is down.
	</p>
	<ul>
      <li>
        <strong>Start after OS boot</strong>: &lt;yes/no&gt; (default: yes)<br>
        PIA-Tunnel VM will attempt to establish a VPN after the operating system has finished booting. Once this option is enabled, you only need to turn on the virtual machine and the VPN connection will be established a few minutes later.
      </li>

      <li>
        <strong>Failvoer 0  n</strong><br>
        These are the locations pia-daemon will use to initiate a VPN connection. Connections are used in sequence so pia-daemon will always create the initial connection with Failover 0, try Failover 1 if the connection fails and so on.<br>
        Setting Failover n to an empty value will remove the Failover setting entirely.
        Warning: Locations marked with a * support port forwarding. Keep in mind that the open network port is assigned to you by your VPN provider and will change when you connect to a different location! I provide a monitoring script to detect these port changes, reconfigure your torrent client and restart the application.<br>
        Please see Starting your Torrent client with monitor.vbs for details.
      </li>
	</ul>
	</div>

	<div id="s_adv" class="sub_section">
	<h3>Settings - Advanced Settings</h3> <a href="#main_index">Back To Top</a>
	<p>
      The advanced settings are below the General Settings. Click on Show Advanced Settings to display the options.<br>
      <strong>WARNING</strong>: You can really mess things up in here and may even compromise your security by changing the wrong option.
	</p>

	<ul>
      <li>
        <strong>Enable Port Forwarding</strong> : &lt;yes/no&gt; (default: no)<br>
        This option enables port forwarding to a computer connected to PIA-Tunnel. Only set this to yes if you intend to run a server or torrent client. Please see Running a Server or Torrent Client for details
      </li>

      <li>
        <strong>Forward IP</strong>: &lt;some IP&gt; (default: 192.168.10.100)<br>
        This is the target IP of the open port. The option is only available when Enable Port Forwarding is set to yes.
      </li>
      <li><strong>Public LAN interface</strong>: &lt;eth0/eth1/tun0&gt; (default: eth0)<br>
          Specifies which interface is connected to your public LAN.
          WARNING: Dont change this!
      <li><strong>VM LAN interface</strong>: &lt;eth0/eth1/tun0&gt; (default: eth1)<br>
          Specifies which interface is connected to the private VM LAN segment.
          WARNING: Dont change this!</li>
      <li><strong>VPN interface</strong>: &lt;eth0/eth1/tun0&gt; (default: tun0)<br>
          Specifies which interface will be handling the VPN connection.
          WARNING: Dont change this!</li>
      <li><strong>eth0 use DHCP</strong>: &lt;yes/no&gt; (default: yes)<br>
          Allows you to configure a fixed IP for eth0 or use an existing DHCP server. This interface will be connected to your LAN where your cable/DSL router is providing DHCP service. Dont change this unless you need to set a static IP.
      <li><strong>eth0 IP/Subnet/Gateway</strong> (default: all empty)<br>
          These options are enabled when eth0 use DHCP is set to no.</li>
      <li><strong>eth1 use DHCP</strong>: &lt;yes/no&gt; (default: no)<br>
          Allows you to configure a fixed IP for eth1 or use an existing DHCP server. This interface is connected to your private VM LAN segment without a DHCP server. PIA-Tunnel provides DHCP service for this segment so the IP must be fixed.<br>
          I recommend that you dont change this unless you know networking.</li>
      <li><strong>eth1 IP/Subnet/Gateway</strong> (default: IP:192.168.10.1 Subnet: 255.255.255.0 Gateway: empty)<br>
          These options are enabled when eth1 use DHCP is set to no.</li>
      <li><strong>DNS 1-4</strong><br>
          Specifies the DNS servers used by PIA-Tunnel VM. The VM ships with the following defaults:<br>
          8.8.8.8 is a public DNS Server hosted by Google.com<br>
          208.67.222.222 is a public DNS Server hosted by OpenDNS.com<br>
          8.8.4.4 is a public DNS Server hosted by Google.com<br>
          208.67.220.220 is a public DNS Server hosted by OpenDNS.com</li>

      <li><strong>Max allowed packet loss</strong>: &lt;0%-100%&gt; (default: 20%)<br>
          Specifies how many ping packets may be lost, per check, before pia-daemon considers the VPN connect as down/bad. Pia-daemon will attempt to connect to Failover 1 through n when the ping failure rate is above this threshold.</li>
      <li><strong>Verbose / Debug Verbose</strong>: &lt;yes/no&gt; (default: no)<br>
          Enables verbose or verbose debug mode on the command line. This option is not used by the web-UI.
      </li>
    </ul>
	</div>

	<div id="s_dhcpd" class="sub_section">
	<h3>Settings - DHCP Server Settings</h3> <a href="#main_index">Back To Top</a>
	<p>
      This box gives you access to the configuration file of the DHCP Server running inside PIA-Tunnel.
      The current UI supports up to two subnets.<br>
      Please contact support (from Tools page) if you require more subnet options.
	</p>

	<ul>
      <li><strong>Subnet 1</strong>:  &lt;enabled/disabled&gt; (default: enabled)<br>
          Adds the following settings to the configuration file if enabled or removes them when disabled.
      </li>
      <li><strong>Subnet  IP 1</strong>: &lt;IP Address&gt; (default: 192.168.10.0)<br>
          IP address of the network
      </li>
      <li><strong>Subnetmask 1</strong>: &lt;IP Address&gt; (default: 255.255.255.0)<br>
          Subnetmask used by any DHCP clients on your network
      </li>
      <li><strong>Broadcast IP 1</strong>: &lt;IP Address&gt; (default: 192.168.10.255)<br>
          Broadcast IP used by any DHCP clients on your network
      </li>
      <li><strong>Router/Gateway 1</strong>: &lt;IP Address&gt; (default: 192.168.10.1)<br>
          Gateway IP used by any DHCP clients on your network
      </li>
      <li><strong>IP Range 1</strong>: &lt;IP_Address IP_Address&gt;> (default: 192.168.10.1<br>01 192.168.10.151)
          Range of IPs used by the DHCP server.<br>
          Please note the format of &lt;IP Address&gt;&lt;SPACE&gt;&lt;IP Address&gt;
      </li>
      <li><strong>Subnet 2</strong>: &lt;enabled/disabled&gt; (default: disabled)<br>
          You may setup a second IP Range using the Subnet 2 option.<br>
          Warning: Only use this if you know networking!
      </li>
      <li><strong>Subnet IP/Subnetmask/Broadcast IP/Router/Gateway/IP Range</strong><br>
          Same definition as Subnet 1 but the settings must not define the same range.<br>
          Warning: Only use this if you know networking!
      </li>
      <li><strong>Fixed IP</strong>: &lt;IP Address&gt; (default: empty)<br>
          Specifies one fixed IP that will be assigned to a computer with a MAC address matching the MAX for IP setting. You should also enter this IP into Forward IP found in General Settings
      </li>
      <li><strong>MAC for IP</strong>: &lt;MAC Address&gt; (default: empty)<br>
          Specifies which computer will receive the Fixed IP specified above.<br>
          Please note: The MAC Address must be separated by colons (:). Example: 00:0D:28:A7:3C:45
      </li>
	</ul>
	</div>

</div>

<div id="client_setup_overview" class="section">
	<h2>Configure Client Devices to use the VPN</h2> <a href="#main_index">Back To Top</a>
    <p>
      <strong>WARNING:</strong> Do not connect both interfaces to the same network. It will create
      routing conflicts and the VPN will fail to connect.<br>
      Remove the second network card if you don't intend use network isolation. You may always add
      the interface later.
    </p>

    <p>
      PIA-Tunnel may share your VPN connection as a SOCKS5 proxy server or as a default gateway for your nework.
    </p>

    <ul>
        <li>
            <strong>Using the build in SOCKS5 proxy server</strong> is very easy to setup but every program needs to be configured individually. This options works great if you want to switch your webbrowser to use the VPN but does not support incoming port forwarding.
        </li>
        <li>
            <strong>PIA-Tunnel as a default gateway</strong> for the rest of your network. The computer sharing the connection needs to have two ip addresses. One will be used to create the VPN connection and the other is used by your clients to access the VPN.<br>
            PIA-Tunnel is designed for this environment and supports all features when setup this way.
        </li>
    </ul>
</div>


<div id="socks5_setup" class="section">
	<h2>SOCKS5 Proxy Setup</h2> <a href="#main_index">Back To Top</a>

	<p>
      Using the SOCKS5 proxy is a great way to get around country blocks without major changes.
      Simply change your browser settings and your are done.<br>
      This option may also be used on a device that is already setup
      as a default gateway for your network.
	</p>

	<ul>
      <li>Goto "Settings" and set "Enable Port Forwarding" to "no"</li>
      <li>Goto "Settings" => "SOCKS5 Proxy Server" and set "Public LAN" to enable</li>
      <li>Disconnect or change your current VPN connection. The SOCKS5 server will be started once the VPN connection is established.</li>
      <li>All done. Use the "Public LAN IP" and the SOCKS5 port in your browser or other programs that support SOCKS5 servers.</li>
	</ul>

	<p>
      <a href="http://www.proxifier.com/proxychecker/" target="_blank">Proxychecker</a> is a free tool to check if everything is working properly.<br>
      <a href="./grfx/proxychecker_settings.png"><img src="./grfx/proxychecker_settings-small.png"></a>
      <a href="./grfx/proxychecker_test.png"><img src="./grfx/proxychecker_test-small.png"></a>
	</p>

	<p>
      Example of the required settings for FireFox. Don't forget to exclude the Public LAN IP or you will not be able to access the webUI while using the proxy ("No Proxy for" box).<br>
      <a href="./grfx/firefox_socks.png"><img src="./grfx/firefox_socks-small.png"></a>
	</p>
</div>


<div id="defaultgw_setup" class="section">
	<h2>Default Gateway Setup</h2> <a href="#main_index">Back To Top</a>

	<p>
      PIA-Tunnel is primarily designed to act as a default gateway for one or
      more client devices on your network.
      Unlike the SOCKS5 proxy, which needs to be configured per program.
      The default gateway is an operating system setting that is configured once.
      It forces your programs to send all traffic through the default gateway, the VPN tunnel.
    </p>
    <p>
      The basic configuration makes use of one network adapter to connect
      to the VPN and share the connection with your network.<br>
      While a more advanced setup may utilize two network adapters to physically isolate
      your network from the Internet side.
    </p>


    <div id="defaultgw_single" class="sub_section">
      <h2>Basic - One Network Interface</h2> <a href="#main_index">Back To Top</a>
      <p>
        <strong>WARNING:</strong> Do not connect both interfaces to the same network. It will create
        routing conflicts and the VPN will fail to connect.<br>
        Remove the second network card if you don't intend use network isolation. You may always add
        the interface later.
      </p>

      <p>
        The basic setup will use one network card to connect to the VPN and share the connection
        with your network.
      </p>

      <ul>
        <li>
          Begin by configuring a static IP for your network interface. This will be the IP
          your clients use as the default gateway setting.
          <ul>
            <li>Settings =&gt; General Settings
              <ul>
                <li>Set "VPN Gateway for public LAN" to "yes"</li>
              </ul>
            </li>
            <li>Settings =&gt; Advanced Settings
              <ul>
                <li>
                  Disable DHCP Server by setting "Subnet 1" and "Subnet 2" to disable<br>
                  You may also use the build on DHCP Server if you disable the DHCP Server
                  running on your router. There must only be one DHCP Server on a basic network!
                </li>
                <li>Set "Enable Port Forwarding" to "no" for now. You may enable this later
                <li>
                  Set "eth0 use DHCP" to "no" and fill out the IP, Subnet and Gateway field.<br>
                  Here, gateway is the IP of your router/modem
                </li>
              </ul>
            </li>
          </ul>
        </li>

        <li>
          Go back to the Overview page and click on the reboot button. Wait a bit and then
          use the IP you just entered to reopen the webUI
        </li>

        <li>
          Connect to your VPN and wait until the overview page says "VPN Gateway enabled"
        </li>

        <li>
          Time to configure your client devices and add the "Public LAN" IP as a default gateway.<br>
        </li>

        <li>
          <a href="http://www.network-technologies.org/Projects/user_agent-ip_address.php" target="_blank">Verify that your clients are using the VPN</a> by checking your Internet IP.
          It should be the same as the Public VPN IP listed on the overview page.
       </li>
      </ul>
    </div>


    <div id="defaultgw_dual" class="sub_section">
      <h2>Advanced - Two Network Interfaces</h2> <a href="#main_index">Back To Top</a>

      <p>
        Advanced setup - or the "this is what PIA-Tunnel was designed for" setup.<br>
        The Guide is currently written with PIA-Tunnel running on a Raspberry Pi. Everything
        here should be true for any Debian 7 setup running the PIA-Tunnel scripts.<br>
      </p>

      <p>
        This setup separates your network from the Internet by physically separating the two.
        One network interface is connected to the Internet while the other connects to your LAN. There
        are no other interconnects between the network so all traffic must flow through
        the PIA-Tunnel gateway, the VPN connection.
      </p>

      <p>
        This can either be achieved by using PIA-Tunnel as a virtual machine, with on card connected
        to your LAN and another to a private VM LAN. Any virtual machines that are only connected to
        this VM LAN will be completely isolated from any other network.<br>
        This section of the guide will focus on a typical home setup. Your computer connects
        to the Internet via a router or modem.<br>
        <strong>WARNING</strong> WLAN connections offered by that router will
        be connected to the public network! VPN access is possible but these connections are not isolated.
      </p>

      <p>
        <img src="./grfx/default_home_network.png" alt="typical home network map"><br>
        The image above is an example of a typical home setup with one or
        more PCs hardwired to the router while laptops and tablets use the WLAN.
      </p>
      <p>
        PIA-Tunnel running on a Raspberry Pi would create a second network behind the router.
        One network connects to the first network card, the other to the second network card. Complete isolation.<br>
        You could turn WLAN off at your Internet router and replace the network switch inside
        the isolated network with an access point/switch combo.
        Many things are possible with networking ... .
        <img src="./grfx/default_home_pia_standalone.png" alt="typical home network map"><br>
      </p>

      <div class="sub_section">
        <h3>Let's get started....</h3>
        <p>First get the IP of your router</p>
        <ul>
          <li>First get the IP of your router</li>
          <li>Make sure your have two network adapters connected, then start the device
            running PIA-Tunnel .... Virtual Machine, Raspberry Pi, ....</li>
          <li>Open the webUI make sure that the "Overview" page shows a "Public LAN	IP" and a "VM LAN IP"</li>
          <li>Open Settings and click on Advanced towards the bottom of the page</li>
          <li>
            The public LAN IP may be assigned by your router or be static. I recommend a static IP for all
            devices that offer a service on your network.
          </li>
          <li>time for a brake.....</li>
        </ul>
      </div>
    </div>
</div>


<div id="transmission_setup" class="section">
  <h2>Setup transmission daemon (torrent client) on the VM</h2> <a href="#main_index">Back To Top</a>
  <p>
    <strong>WARNING</strong> this feature is barely tested and could be quite dangerous to use!<br>
    The idea behind PIA-Tunnel was to separate the computer accessing the VPN from the rest of the network.
    This is done to prevent traffic from leaking out when the VPN is not connected.
  </p>
  <p>
    Installing transmission on the VM itself presents a problem when the VPN goes down and IF the firewall
    rules are set back to the disconnected state. The firewall will allow traffic to exit on eth0 so the
    torrent client may switch from tun0 to eth0 and traffic will now originate from your ISP, your IP!
  <p>
    I have implemented a few security checks but have not done much testing - keep this in mind when you use this feature!<br>
    The VPN stop scripts are currently checking for any running transmission-daemons and will not disconnect
    the VPN until the process has ended. The VM will flush the firewall, deny ANY further traffic and reboot if the
    torrent client fails to terminate. This <strong>should</strong> prevent any traffic from leaking ....<br>
    These safety checks have been added to pia-daemon and pia-stop.
  </p>

  <p>
    Looks like the warning above did not scare you off. Please report any issues or improvement suggestions.<br>
    The VM is designed to be as small as possible so the idea is that you share some hard drive space
    from a computer on your network and make it available as a Windows/SMB/CIFS share.<br>
    The VM will connect to that network drive and use it to store the downloaded files.
  </p>

  <div>
    <ul>
      <li>Click on the "Install transmission-daemon" link found under Settings to start the installation process.
        This will run a complete system update before installing transmission and the VM will reboot once completed.<br>
          You may also run the installation manually by executing "/usr/local/pia/include/transmission-install.sh"<br>
      </li>
    </ul>
  </div>
</div>






<div id="defaultgw_bindnic" class="section">
  <h2>Single PC with Default Gateway Setup</h2> <a href="#main_index">Back To Top</a>
  <p>
    It is possible to use the PIA-Tunnel connection on the host PC by installing a loop back
    network adapter and configuring your program to use it. This is not recommended but it
    is possible.
  </p>

  <ol>
    <li><a href="https://www.google.com/search?q=windows+install+loopback+adapter" target="_blank">Install a loop back network adapter</a></li>
    <li>Configure the new adapter using the following settings.<br>
        IP: 192.168.90.10, Subnet: 255.255.255.0, Gateway: 192.168.90.1
    </li>
    <li>Start the "VMware Virtual Network Editor" and elevate to Administrator (Change Settings Button)<br>
      <ol>
        <li>Click "Add Network", Accept suggested network by clicking OK.</li>
        <li>Select the new network in the overview box</li>
        <li>Select "Bridged" under "VMnet Information" and use the dropdown menu to select
        the Microsoft Loopback Adapter</li>
      </ol>
      <a href="./grfx/VMware_VNE.png"><img src="./grfx/VMware_VNE-small.png" alt="VMware Virtual Network Editor screenshot"></a>
    </li>

    <li>
      Open the VMware configuration for PIA-Tunnel and set the first network adapter to
      bridged or NAT. Set the second network adapter to custom and choose the network created
      with the Virtual Network Editor.<br>
      <img src="./grfx/loopback_VM.png" alt="VMware Virtual Network Editor screenshot">
    </li>

    <li>
      Start PIA-Tunnel and update the following Settings
      <ol>
        <li>VPN Gateway for VM LAN: yes, VPN Gateway for public LAN: no</li>
        <li>eth1 IP: 192.168.90.1, eth1 Subnet: 255.255.255.0, eth1 Gateway: EMPTY</li>
        <li>DHCP Server: both disabled</li>
        <li>Enable Port Forwarding: yes, Forward to this IP: 192.168.90.10</li>
        <li>Click on the "Store Settings" button and reboot the VM.</li>
      </ol>
      Note: Ignore the dhcp-server error message after you reboot the VM.
    </li>

    <li>
      Goto "Tools" =&gt; "Ping Utility" and test the following.
      <ul>
        <li>Outgoing interface: eth0, Name or IP: IP of Your Router</li>
        <li>Outgoing interface: eth1, Name or IP: 192.168.90.10</li>
      </ul>
      Check the results for "8 packets transmitted, 8 received, <strong>0% packet loss</strong>"
    </li>

    <li>
      Finally configure your software to use the network interface. This needs to be supported by your software!<br>
      <a href="./grfx/qbittorrent_loopback.png"><img src="./grfx/qbittorrent_loopback-small.png" alt="qBittorrent Advanced Config screenshot"></a>
    </li>
  </ol>

  <p>
    <strong>Final Words</strong> I would not consider using this setup because you rely on the application to send your
    data to the correct interface. Any bug in the code and your data may end up getting send out
    the wrong interface....
  </p>

</div>

<div id="pi_setup" class="section">
  <h2>PIA Tunnel on a Raspberry Pi</h2> <a href="#main_index">Back To Top</a>
  <p>
    You may use an inexpensive <a href="http://www.raspberrypi.org/" target="_blank">Rasperry Pi</a> to setup a permanent VPN router on your network.
    The Pi is relatively inexpensive and does not use much power so it is a great candidate when you don't
    run a local server.<br>
    This section of the guide explains how to set up the RasbPi using only one network card.
    It is also possible to set it up with two network cards which completely isolates your
    LAN from the non-VPN tunneled Internet.
  </p>

  <p>
    <strong>WARNING:</strong> Do not connect both interfaces to the same network. It will create
    routing conflicts and the VPN will fail to connect.<br>
    Remove the second network card if you don't intend use network isolation. You may always add
    the interface later.
  </p>

  <p>
    2015-03-17 - Current test results with a Raspberry Pi 1 B+<br>
    * works well when setup as a default gateway.
    tested with 1,1MB/s transfer speed through VPN tunnel<br>
    * SOCKS5 adds a lot of CPU load on top of handling the encrypted VPN tunnel.
      works good with small loads such as browsing and watch a HQ Twitch stream or two.<br>
  </p>

  <ul>
    <li>Start by installing <a href="http://downloads.raspberrypi.org/raspbian_latest.torrent">Raspbian</a> onto your SD card</li>
    <li>Login with pi:raspberry and elevate to root
      <pre>
        sudo su -
      </pre>
    </li>
    <li>Make sure the OS is up to date
      <pre>
        apt-get update -y
        apt-get upgrade -y
      </pre>
    </li>
    <li>Use raspi-config to overclock your CPU to TURBO or the VPN connection will not be established! (RasbPi 1 only)</li>
    <li>Make sure you have the "en_US.UTF-8" locale installed. Use raspi-config</li>
    <li>
      run the following command to install the required software. You may receive an error message when installing the DHCP server. You may ignore  it at this point.<br>
      <pre>
        apt-get install -y psmisc openvpn dnsutils isc-dhcp-server vim git-core gawk curl psmisc lighttpd php5-cgi php5-curl php5-cli php5-mcrypt sudo ca-certificates
      </pre>
    </li>
    <li>
      Run the following commands
      <pre>
        update-rc.d lighttpd enable
        lighttpd-enable-mod fastcgi fastcgi-php
        /etc/init.d/lighttpd force-reload
        addgroup vpnvm
        usermod -G vpnvm www
        usermod -G vpnvm root
        echo "0" > /proc/sys/vm/swappiness
      </pre>
    </li>

    <li>
      Make sure that you use a valid DNS server. These settings will override the DNS server
      sent by your router. Edit /etc/dhcp/dhclient.conf and add the following on line 21
      <pre>
        supersede domain-name-servers 8.8.8.8, 208.67.222.222, 8.8.4.4, 208.67.220.220;
      </pre>
    </li>

    <li>
      Edit /etc/resolv.conf and add alternative name servers
      <pre>
        nameserver 8.8.8.8
        nameserver 208.67.222.222
        nameserver 8.8.4.4
        nameserver 208.67.220.220
      </pre>
    </li>

    <li>
      Add the following to line 21 in /etc/sudoers
      <pre>
        www ALL = NOPASSWD: /usr/local/pia/*,/usr/local/pia/include/*,/sbin/shutdown
      </pre>
    </li>

    <li>
      Almost done. Time to pull the PIA Tunnel scripts .... this will take a bit
      <pre>
        mkdir /usr/local/pia ; chown -R root:root /usr/local/pia ; chmod -R og-rwx /usr/local/pia;
        git clone https://github.com/KaiserSoft/PIA-Tunnel.git /usr/local/pia
        cd /usr/local/pia ; git checkout release_php-gui
      </pre>
    </li>

    <li>
      The next commands will execute the PIA-Tunnel setup script.
      Please report any error messages you encounter.
      <pre>
        chmod 777 /usr/local/pia/pia-setup ; /usr/local/pia/pia-setup
      </pre>
    </li>

    <li>
      Add the following line to /etc/rc.local make sure you paste it above "exit 0"
      <pre>
        /usr/local/pia/include/autostart.sh
      </pre>
    </li>

    <li>
      <p>
        Reboot your system  and open the IP of your Rasberry Pi in your webbrowser.
        Your RasbPi is now setup to act as a stand alone VPN router. Please follow the
        the setup Wizard Tutorial next.
      </p>
      <a href="./grfx/static_ip_wizard.png"><img alt="start wizard after reboot" src="./grfx/static_ip_wizard-small.png"></a>
    </li>
  </ul>

</div>




<div id="h_firewall" class="section">
  <h2>Connection issues with new VMs</h2> <a href="#main_index">Back To Top</a>

  <p>
    Firewalls will sometimes interfere with outgoing communication until the outgoing traffic
    is allowed to pass through. This tends to screw up the initial reset and setup procedure.
  </p>

  Below are a few things that should fix the condition. Try one and check if the problem persists.
  <ul>
    <li>
      Delete the VM and redeploy with the primary network adapter set to "NAT". Some firewalls
      can not handle bridged VM traffic, OnlineArmor is one of them.
    </li>

    <li>
      Login to the command line and run pia-setup and pia-update manually.<br>
      The root password is "pia" before you run the setup wizard or some random string afterwards.
      Please use "Settings" =&amp; "Linux root Password" to change it.<br>
      Now run the following commands and check the output for any error messages
      <ul><li>pia-setup</li><li>pia-update</li></ul>
    </li>
  </ul>
</div>
</body>
</html>